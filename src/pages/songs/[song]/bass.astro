---
export async function getStaticPaths() {
  const songs = await Astro.glob('../../../content/songs/*.md');
  
  return songs.map(song => ({
    params: { 
      song: song.frontmatter.title.toLowerCase().replace(/ /g, '-')
    },
    props: { 
      title: song.frontmatter.title,
      bass: song.frontmatter.bass
    }
  }));
}

const { title, bass } = Astro.props;

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ID YouTube –∏–∑ —Å—Å—ã–ª–∫–∏
function getYouTubeId(url) {
  if (!url) return '';
  const match = url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);
  return match ? match[1] : '';
}
---

<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width" />
  <title>{title} - –ë–∞—Å-–≥–∏—Ç–∞—Ä–∞</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    .container { max-width: 900px; margin: 0 auto; }
    header { background: white; padding: 25px; border-radius: 10px; margin-bottom: 30px; }
    h1 { color: #2c3e50; }
    .resource-card { background: white; padding: 25px; border-radius: 10px; margin-bottom: 25px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .resource-card h3 { color: #34495e; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
    .btn { display: inline-block; padding: 12px 25px; background: #3498db; color: white; text-decoration: none; border-radius: 5px; margin-right: 10px; }
    .btn:hover { background: #2980b9; }
    .btn-youtube { background: #ff0000; }
    .btn-youtube:hover { background: #cc0000; }
    .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; margin: 20px 0; }
    .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 5px; }
    .tabs { background: #2c3e50; color: white; padding: 20px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; overflow-x: auto; }
    .back-link { display: inline-block; margin-top: 20px; color: #3498db; text-decoration: none; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üéµ {title} - –ë–∞—Å-–≥–∏—Ç–∞—Ä–∞</h1>
      <a href="/" class="back-link">‚Üê –í—Å–µ –ø–µ—Å–Ω–∏</a> | 
      <a href={`/songs/${Astro.params.song}`} class="back-link">‚Üê –í—ã–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞</a>
    </header>

    <!-- Songsterr —Å—Å—ã–ª–∫–∞ -->
    {bass?.songsterr && (
      <div class="resource-card">
        <h3>üé∏ –¢–∞–±—ã –Ω–∞ Songsterr</h3>
        <p>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–±—ã —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º–ø–∞</p>
        <a href={bass.songsterr} target="_blank" class="btn" rel="noopener">
          –û—Ç–∫—Ä—ã—Ç—å –≤ Songsterr ‚Üí
        </a>
      </div>
    )}

    <!-- YouTube –≤–∏–¥–µ–æ -->
    {bass?.youtube && (
      <div class="resource-card">
        <h3>üé• –†–∞–∑–±–æ—Ä –Ω–∞ YouTube</h3>
        <div class="video-wrapper">
          <iframe 
            src={`https://www.youtube.com/embed/${getYouTubeId(bass.youtube)}`}
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen>
          </iframe>
        </div>
        <a href={bass.youtube} target="_blank" class="btn btn-youtube" rel="noopener">
          –û—Ç–∫—Ä—ã—Ç—å –Ω–∞ YouTube
        </a>
      </div>
    )}

    <!-- –ü—Ä–æ—Å—Ç—ã–µ —Ç–∞–±—ã -->
    {bass?.tabs && (
      <div class="resource-card">
        <h3>üìÑ –ü—Ä–æ—Å—Ç—ã–µ —Ç–∞–±—ã</h3>
        <div class="tabs">{bass.tabs}</div>
      </div>
    )}

    {!bass?.songsterr && !bass?.youtube && !bass?.tabs && (
      <div class="resource-card">
        <p>–†–∞–∑–±–æ—Ä –¥–ª—è –±–∞—Å-–≥–∏—Ç–∞—Ä—ã –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω</p>
      </div>
    )}
  </div>
</body>
</html>